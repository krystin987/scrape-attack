on: [push]
  # schedule:
  #   - cron: '30 5 * * 1,3'
  #   - cron: '30 5 * * 2,4'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.x'
      - name: install lxml
        run: |
          sudo apt-get install python3-lxml
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
      - uses: krystin987/ssh-key-action
        with:
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          name: id_rsa
          known_hosts: ${{ secrets.KNOWN_HOSTS }}
      - name: Check out code
        uses: actions/checkout@v1
        env:
          GITHUB_TOKEN: ${{ github.token }}
      - name: Initialize mandatory git config
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          git config -l
          git config user.name "Krystin Villeneuve"
          git config user.email krystinv@gmail.com
      - name: Create data update branch
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: git checkout github_action_update
      - name: install dependencies
        run: |
          pip install -r requirements.txt
      - name: Run utility tool
        working-directory: ./scraper_command_line_utility
        run: python3 -m scraper dog
      - name: Commit changelog and manifest files
        id: make-commit
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          git add .
          git commit --message "update data with run ${{ github.event.inputs.versionName }}"
          echo "::set-output name=commit::$(git rev-parse HEAD)"
      - name: Remove remote
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: git remote rm origin
      - name: Add remote
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: git remote add origin git@github.com:krystin987/scrape-attack.git
      - name: Push new branch
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: git push origin github_action_update